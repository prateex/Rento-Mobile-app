# Rento Android APK Build Guide

## Overview
This document outlines the steps to build an Android APK from the Rento Vite + React + Express application using Capacitor.

## Prerequisites
- Node.js 16+ installed
- Android Studio installed (latest version)
- Android SDK 21+ (minimum)
- Java Development Kit (JDK) 11+
- Gradle 7.4+

## Project Changes Made for Capacitor Support

### 1. **vite.config.ts**
- Changed build output from `dist/public` to `dist`
- This ensures the built React app is directly in the Capacitor web directory

### 2. **capacitor.config.ts** (NEW)
- App ID: `com.rento.app`
- App Name: `Rento`
- Web Directory: `dist`
- Server configuration for Android WebView
- SplashScreen plugin disabled (set to 0)

### 3. **package.json**
Added new scripts:
- `npm run build` - Builds Vite React app to `dist` folder
- `npm run cap:sync` - Syncs built assets to Android platform
- `npm run cap:open` - Opens Android Studio with the Android project
- `npm run cap:build` - Builds and syncs in one command

Added Capacitor dependencies:
- `@capacitor/core`
- `@capacitor/cli`
- `@capacitor/android`

### 4. **.gitignore**
Added Capacitor-generated folders to ignore:
- `android/`
- `.capacitor/`

## Installation & Setup Steps

### Step 1: Install Dependencies
```bash
npm install
```

### Step 2: Install Capacitor Packages
```bash
npm install @capacitor/core @capacitor/cli @capacitor/android
```

### Step 3: Build the React App
```bash
npm run build
```
This creates the compiled React app in the `dist` folder.

### Step 4: Initialize Capacitor (First Time Only)
If the `android` folder doesn't exist yet, initialize it:
```bash
npx cap init
```
Follow the prompts and confirm:
- App Name: `Rento`
- App ID: `com.rento.app`

### Step 5: Add Android Platform
```bash
npx cap add android
```
This creates the `android` folder with the native Android project.

### Step 6: Sync Web Assets
```bash
npm run cap:sync
```
or
```bash
npx cap sync
```
This copies the built React app from `dist` into the Android WebView assets.

### Step 7: Open in Android Studio
```bash
npm run cap:open
```
or
```bash
npx cap open android
```
This opens the Android Studio project automatically.

## Building the APK

### Option A: Using Android Studio GUI (Recommended for First Build)
1. Open Android Studio (via `npm run cap:open`)
2. Wait for Gradle sync to complete
3. Go to **Build > Build Bundle(s) / APK(s) > Build APK(s)**
4. Select a build variant (Debug for testing, Release for production)
5. Wait for the build to complete
6. APK will be generated in: `android/app/build/outputs/apk/debug/app-debug.apk`

### Option B: Using Command Line (Gradle)
```bash
cd android
./gradlew assembleDebug
cd ..
```
Output: `android/app/build/outputs/apk/debug/app-debug.apk`

For release build:
```bash
cd android
./gradlew assembleRelease
cd ..
```

## Development Workflow

### Making Code Changes
1. Modify React/TypeScript files in `client/src/`
2. Run `npm run build` to rebuild
3. Run `npm run cap:sync` to sync changes to Android
4. Reload in Android Studio or run the app again

### Quick Build & Sync
```bash
npm run cap:build
```

## File Structure
```
project-root/
├── capacitor.config.ts       (NEW - Capacitor config)
├── vite.config.ts            (MODIFIED - dist output)
├── package.json              (MODIFIED - scripts & deps)
├── .gitignore                (MODIFIED - Capacitor exclusions)
├── client/
│   ├── index.html            (Entry point)
│   └── src/                  (React components - unchanged)
├── dist/                      (Built React app - generated by npm run build)
├── android/                   (Native Android project - generated by npx cap add)
└── server/                    (Express backend - unchanged)
```

## Troubleshooting

### Build fails with "Module not found"
- Delete `node_modules` and `dist` folders
- Run `npm install`
- Run `npm run build`

### APK install fails on device
- Ensure Android version on device is 21 (Android 5.0) or higher
- Enable "Unknown Sources" in device settings
- Check device logs: `adb logcat`

### WebView shows blank screen
- Verify `dist` folder contains built files
- Check browser console in Android Studio: **View > Tool Windows > Logcat**
- Ensure `capacitor.config.ts` has correct `webDir: 'dist'`

### Capacitor initialization issues
- Delete `android` and `.capacitor` folders
- Run `npx cap add android` again

## Important Notes

✅ **Unchanged:**
- Express backend code (`server/`)
- React components and business logic (`client/src/`)
- Database configuration and models

✅ **Ready for Production:**
- Capacitor handles all native Android integration
- Your existing React app loads directly in Android WebView
- No rewrites of existing logic

⚠️ **For Release Builds:**
- Update version in `capacitor.config.ts` (add `appVersion`)
- Sign APK with your release key (instructions in Android Studio)
- Test thoroughly on multiple Android versions

## Commands Reference

| Command | Purpose |
|---------|---------|
| `npm run build` | Build React app to `dist` |
| `npm run cap:sync` | Sync to Android platform |
| `npm run cap:open` | Open Android Studio |
| `npm run cap:build` | Build + sync in one command |
| `npx cap init` | Initialize Capacitor (first time) |
| `npx cap add android` | Add Android platform |
| `npx cap sync` | Manual sync command |

## Support
For Capacitor documentation: https://capacitorjs.com/docs
For Android Studio help: https://developer.android.com/studio
